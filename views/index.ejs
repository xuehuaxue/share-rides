<!--thank https://www.sitepoint.com/find-a-route-using-the-geolocation-and-the-google-maps-api/ for the nice tutorial-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>welcome to share rides</title>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
</head>
<header>
    <% include ./partials/header %>
</header>
<body>

<div class="main">
    <h1>Welcome to Share Rides</h1>
    <h3>Use this app to share rides with other users. </h3>
    <h4>Poetentially could save you hundreds per year!</h4>
    <form id="calculate-route" name="calculate-route" action="#" method="get">


        <input type="text" id="from" name="from" required="required" placeholder="Departure address" size="30"/>


        <input type="text" id="to" name="to" required="required" placeholder="Destination address" size="30"/>
        <br/>

        <a id="from-link" href="#">Get my position</a>
        <input id='form-button' type="submit" value="submit"/>
        <input id='form-button' type="reset" value="reset"/>
        <a id="to-link" href="#">Get my position</a>
    </form>
    <div id="map"></div>
</div>
<script src="http://maps.google.com/maps/api/js?key=you key"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script>

    function create_map_object() {
        var myoptions = {
            zoom: 10,
            center: {lat: 40.73, lng: -73.95},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        return new google.maps.Map(document.getElementById('map'), myoptions);
    }

    function initMap() {
        var uluru = {lat: 40.73, lng: -73.95};
        var mapObject = create_map_object();
    }

    function calculateRoute(from, to) {

        var mapObject = create_map_object();
        var directionsService = new google.maps.DirectionsService();
        var directionsRequest = {
            origin: from,
            destination: to,
            travelMode: google.maps.DirectionsTravelMode.DRIVING,
            unitSystem: google.maps.UnitSystem.METRIC
        };
        directionsService.route(
            directionsRequest,
            function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    new google.maps.DirectionsRenderer({
                        map: mapObject,
                        directions: response
                    });
                }
                else
                    alert("Unable to retrieve your route");
            }
        );
    }

    $(document).ready(function () {
        initMap();
        // If the browser supports the Geolocation API
        if (typeof navigator.geolocation == "undefined") {
            alert("Your browser doesn't support the Geolocation API");
            return;
        }
        // fetch your current location
        $("#from-link, #to-link").click(function (event) {
            event.preventDefault();
            var addressId = this.id.substring(0, this.id.indexOf("-"));

            navigator.geolocation.getCurrentPosition(function (position) {
                    var geocoder = new google.maps.Geocoder();
                    geocoder.geocode({
                            "location": new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
                        },
                        function (results, status) {
                            if (status == google.maps.GeocoderStatus.OK)
                                $("#" + addressId).val(results[0].formatted_address);
                            else
                                alert("Unable to retrieve your address");
                        });
                },
                function (positionError) {
                    alert("Error: " + positionError.message);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10 * 1000 // 10 seconds
                });
        });

        $("#calculate-route").submit(function (event) {
            event.preventDefault();
            calculateRoute($("#from").val(), $("#to").val());
        });
    });
</script>
</body>
</html>